---
phase: 05-reporting
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/business.tsx
  - src/components/business-scorecard-view.tsx
autonomous: true

must_haves:
  truths:
    - "Score is displayed prominently with large font and color coding"
    - "RAG badge shows status clearly (Green/Amber/Red)"
    - "AI analysis generates automatically when scorecard viewed"
    - "AI analysis completes within 10 seconds"
    - "PDF export works with Chester branding"
  artifacts:
    - path: "src/pages/business.tsx"
      provides: "Business detail page with scorecard display"
      contains: "ScoreHeader"
    - path: "src/components/business-scorecard-view.tsx"
      provides: "Consolidated scorecard view component"
      contains: "AIAnalysisPanel"
  key_links:
    - from: "src/pages/business.tsx"
      to: "src/components/business-scorecard-view.tsx"
      via: "component import"
      pattern: "BusinessScorecardView"
    - from: "src/components/business-scorecard-view.tsx"
      to: "src/components/ai-analysis-panel.tsx"
      via: "component import"
      pattern: "AIAnalysisPanel"
    - from: "src/components/business-scorecard-view.tsx"
      to: "src/hooks/use-pdf-export.ts"
      via: "hook import"
      pattern: "usePdfExport"
---

<objective>
Create a polished individual business scorecard display that prominently shows the 0-100 score with RAG status, auto-generates AI insights, and allows PDF export with Chester branding.

Purpose: This is the primary view Chester admins use to review individual business health. Score visibility and AI insights drive meeting discussions.

Output: Enhanced business detail page with prominent score display, AI analysis, and PDF export.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-reporting/05-RESEARCH.md

# Existing infrastructure
@src/components/score-header.tsx
@src/components/ai-analysis-panel.tsx
@src/hooks/use-pdf-export.ts
@src/components/pdf-export-button.tsx
@src/lib/scoring.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create business scorecard view component</name>
  <files>src/components/business-scorecard-view.tsx</files>
  <action>
Create a new component `BusinessScorecardView` that consolidates the individual scorecard display:

1. **Score display** (top section):
   - Use existing `ScoreHeader` component for score + RAG badge
   - Make score font size larger (text-4xl) for prominence
   - Add month label showing which month the scorecard is for

2. **AI Analysis section**:
   - Import and use existing `AIAnalysisPanel` component
   - Pass scorecard, previousScorecard, and businessName props
   - AI auto-generates on mount if not already present (existing behavior)

3. **PDF Export**:
   - Add PDF export button at top right of component
   - Use existing `PdfExportButton` component (already handles lazy loading)
   - Button should be visually prominent but not dominant

4. **Section scores overview** (optional quick glance):
   - Show 6 section scores in a compact row below main score
   - Use `calculateSectionScores` from `@/lib/chart-utils`
   - Color-code each using `getScoreColor` from `@/lib/heatmap-utils`

Props interface:
```typescript
interface BusinessScorecardViewProps {
  scorecard: Scorecard
  previousScorecard: Scorecard | null
  businessName: string
}
```

Use existing components - do NOT reimplement scoring, PDF generation, or AI analysis.
  </action>
  <verify>
File exists and exports `BusinessScorecardView` component. TypeScript compiles without errors:
```bash
npx tsc --noEmit
```
  </verify>
  <done>
Component renders score prominently, shows AI analysis panel, and has PDF export button. All existing functionality preserved through composition.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate scorecard view into business page</name>
  <files>src/pages/business.tsx</files>
  <action>
Update the business detail page to use the new consolidated view:

1. **Check if business.tsx exists**, if not create it. It should be the page at `/business/:businessId` showing:
   - Business name and sector
   - Latest scorecard with prominent score display
   - Scorecard history list

2. **Replace any inline scorecard display** with the new `BusinessScorecardView` component:
   - Pass latest scorecard from `useBusinessScorecards` hook
   - Pass previous scorecard (second item in sorted list)
   - Pass business name

3. **Layout structure**:
   ```
   +----------------------------------+
   | < Back    [Business Name]    [PDF Export] |
   +----------------------------------+
   | Score: 75/100 [Green]           |
   | Month: January 2026             |
   +----------------------------------+
   | [Section scores row]            |
   +----------------------------------+
   | AI Analysis                     |
   | - Executive Summary             |
   | - Questions for Next Call       |
   | - 30-Day Actions                |
   +----------------------------------+
   | Scorecard History               |
   | - Jan 2026 - 75 - View          |
   | - Dec 2025 - 72 - View          |
   +----------------------------------+
   ```

4. **Ensure proper data fetching**:
   - Use `useBusinessScorecards(businessId)` for history
   - Use existing `useBusinesses` for business details
   - Handle loading and empty states

Do NOT change navigation routes or authentication - those are already set up.
  </action>
  <verify>
Navigate to `/business/{businessId}` in browser. Verify:
1. Score displays prominently at top
2. AI analysis panel appears (generates if needed)
3. PDF export button visible and functional
```bash
npm run dev
# Visit http://localhost:5173/business/{any-business-id}
```
  </verify>
  <done>
Business detail page shows scorecard with prominent score, AI analysis generates within 10 seconds, PDF exports with Chester branding. REPORT-01, REPORT-02, REPORT-05 satisfied.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. **REPORT-01 (Score display):** Score prominently visible with color coding
   - Visit any business page, score should be first thing visible
   - RAG badge (Green/Amber/Red) clearly shown

2. **REPORT-02 (AI insights):** AI generates automatically
   - If scorecard has no `ai_analysis`, panel shows loading then content
   - Generation completes within 10 seconds
   - Shows: Summary, Questions, Actions, Inconsistencies, Trend Breaks

3. **REPORT-05 (PDF export):** PDF exports cleanly
   - Click PDF export button
   - PDF downloads with Chester/Velocity branding
   - Contains scorecard data and AI analysis

```bash
npm run dev
# Test all three requirements manually
```
</verification>

<success_criteria>
- [ ] Score displayed prominently (large font, color coded)
- [ ] RAG badge visible and correct
- [ ] AI analysis auto-generates when missing
- [ ] AI analysis completes within 10 seconds
- [ ] PDF export button visible
- [ ] PDF contains Chester branding
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-reporting/05-01-SUMMARY.md`
</output>
