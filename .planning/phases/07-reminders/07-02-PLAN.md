---
phase: 07-reminders
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/hooks/use-submission-status.ts
  - src/components/submission-status-panel.tsx
  - src/pages/portfolio.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can see which businesses have submitted for current month"
    - "Admin can see which businesses are pending submission"
    - "Admin can manually trigger reminder emails"
    - "Status updates when business submits"
  artifacts:
    - path: "src/hooks/use-submission-status.ts"
      provides: "React Query hook for submission status"
      exports: ["useSubmissionStatus"]
    - path: "src/components/submission-status-panel.tsx"
      provides: "Panel showing submitted vs pending businesses"
      min_lines: 50
    - path: "src/pages/portfolio.tsx"
      provides: "Integration of submission panel and send button"
  key_links:
    - from: "src/hooks/use-submission-status.ts"
      to: "supabase.from('businesses')"
      via: "TanStack Query"
      pattern: "from\\('businesses'\\)"
    - from: "src/components/submission-status-panel.tsx"
      to: "useSubmissionStatus hook"
      via: "React hook import"
      pattern: "useSubmissionStatus"
    - from: "src/pages/portfolio.tsx"
      to: "send-reminders Edge Function"
      via: "supabase.functions.invoke"
      pattern: "functions.invoke\\('send-reminders'\\)"
---

<objective>
Add submission status visibility and manual reminder trigger to the admin portfolio dashboard.

Purpose: Give Chester admins visibility into who has/hasn't submitted monthly data and ability to send reminders on demand.
Output: Submission status panel on portfolio page with pending/submitted lists and "Send Reminders" button.
</objective>

<execution_context>
@C:\Users\conta\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\conta\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-reminders/07-RESEARCH.md
@.planning/phases/07-reminders/07-01-SUMMARY.md

# Existing portfolio page structure
@src/pages/portfolio.tsx
@src/hooks/use-portfolio-summary.ts

# UI component patterns
@src/components/pending-actions-badge.tsx
@src/components/meeting-summary-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create submission status hook and panel component</name>
  <files>
    src/hooks/use-submission-status.ts
    src/components/submission-status-panel.tsx
  </files>
  <action>
**Hook (src/hooks/use-submission-status.ts):**
- Export useSubmissionStatus(month: string) hook using TanStack Query
- queryKey: ['submission-status', month]
- queryFn:
  1. Fetch all businesses: supabase.from('businesses').select('id, name')
  2. Fetch submitted data_requests for month: supabase.from('data_requests').select('business_id').eq('month', month).eq('status', 'submitted')
  3. Create Set of submitted business IDs
  4. Return array of { id, name, submitted: boolean } for each business
- Return type: UseQueryResult with array of BusinessSubmissionStatus

**Component (src/components/submission-status-panel.tsx):**
- Import useSubmissionStatus hook
- Import Card, CardHeader, CardTitle, CardContent from @/components/ui/card
- Import Button from @/components/ui/button
- Import Badge from @/components/ui/badge
- Import CheckCircle, Clock, Mail, Loader2 from lucide-react
- Import toast from sonner
- Import supabase from @/lib/supabase

Props:
- month: string (YYYY-MM format)

Component structure:
- Card with title "Submission Status" and subtitle showing month
- Show loading skeleton if isLoading
- Two sections: "Submitted" and "Pending"
- Submitted section: List business names with green CheckCircle icon and count badge
- Pending section: List business names with amber Clock icon and count badge
- "Send Reminders" button at bottom:
  - Disabled if no pending businesses
  - onClick: Call supabase.functions.invoke('send-reminders')
  - Show loading spinner during call
  - Toast success/error based on response
- Handle empty states (all submitted, all pending)

Style: Match existing card patterns (portfolio-analysis-card, meeting-summary-card)
  </action>
  <verify>
    - File exists: src/hooks/use-submission-status.ts
    - File exists: src/components/submission-status-panel.tsx
    - Hook exports useSubmissionStatus
    - Component imports useSubmissionStatus
    - Component has "Send Reminders" button with supabase.functions.invoke
  </verify>
  <done>
    - Hook fetches and computes submission status per business
    - Panel displays submitted vs pending lists
    - Manual send button triggers Edge Function
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate submission status panel into portfolio page</name>
  <files>
    src/pages/portfolio.tsx
  </files>
  <action>
Add SubmissionStatusPanel to the portfolio page:

1. Import SubmissionStatusPanel from '@/components/submission-status-panel'

2. Calculate current month for the panel:
   - Use selectedMonth if set, otherwise calculate current month
   - Format: YYYY-MM (e.g., '2026-02')
   - const displayMonth = selectedMonth || format(new Date(), 'yyyy-MM')

3. Add panel to the page layout:
   - Place after the existing AI analysis/meeting summary section
   - Before the main Tabs component (cards/heatmap)
   - Full width card like other analysis cards

   ```tsx
   {/* Submission Status Panel - admin only */}
   <SubmissionStatusPanel month={displayMonth} />
   ```

4. The panel should only show for admins:
   - The portfolio page is already admin-only (RLS handles access)
   - No additional role check needed in this page

5. Ensure the panel responds to month filter changes:
   - When selectedMonth changes, panel re-queries for that month
   - This happens automatically via the month prop

Do NOT modify any other parts of portfolio.tsx - minimal integration only.
  </action>
  <verify>
    - portfolio.tsx imports SubmissionStatusPanel
    - portfolio.tsx renders SubmissionStatusPanel with month prop
    - Month prop uses selectedMonth or current month
    - npm run build passes
  </verify>
  <done>
    - Submission status panel visible on portfolio dashboard
    - Panel shows submission status for selected or current month
    - Send Reminders button works (after Edge Function deployment)
  </done>
</task>

</tasks>

<verification>
1. `npm run build` - no TypeScript errors
2. `npm run dev` - portfolio page loads without errors
3. Submission panel shows two sections (Submitted/Pending)
4. Send Reminders button appears and is clickable
5. Month filter changes update the panel data
</verification>

<success_criteria>
1. Hook returns correct submitted/pending status for each business
2. Panel displays with proper styling matching existing cards
3. Send Reminders button triggers Edge Function (returns 500 until deployed, that's expected)
4. Empty states handled gracefully (all submitted = "All businesses submitted!")
5. Month filter changes reflected in panel
</success_criteria>

<output>
After completion, create `.planning/phases/07-reminders/07-02-SUMMARY.md`
</output>
